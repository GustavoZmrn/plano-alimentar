<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Plano Alimentar do Gustavo ‚Äî Interativo</title>
<meta name="theme-color" content="#0f121a"/>
<style>
  :root{
    --bg:#0b1117; --card:#111827; --soft:#0c1624; --stroke:#1f2a3a;
    --text:#e5e7eb; --muted:#9aa4b2; --accent:#22c55e; --sky:#38bdf8;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  header{position:sticky;top:0;z-index:40;background:linear-gradient(180deg,rgba(17,24,39,.98),rgba(17,24,39,.8));
    border-bottom:1px solid #1f2937;backdrop-filter:saturate(140%) blur(6px)}
  .wrap{max-width:980px;margin:0 auto;padding:14px}
  .row{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
  h1{margin:0;font-size:20px}
  .subtitle{font-size:13px;color:var(--muted)}
  .badge{font-size:12px;padding:4px 8px;border:1px solid #283344;border-radius:999px;color:#cbd5e1}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{padding:8px 10px;border-radius:10px;border:1px solid #283344;background:#0c1320;
    color:#cbd5e1;font-size:13px;cursor:pointer}
  .chip.active{border-color:var(--accent);outline:2px solid rgba(34,197,94,.2)}
  .switch{display:flex;align-items:center;gap:10px;background:#0b1522;border:1px solid var(--stroke);
    border-radius:12px;padding:8px 12px;margin-top:8px}
  .switch input{accent-color:var(--sky);width:18px;height:18px}
  main{padding:12px 0 112px}
  .card{background:var(--card);border:1px solid #202a38;border-radius:14px;padding:14px;box-shadow:0 10px 30px rgba(0,0,0,.25);margin-top:12px}
  .meal h2{margin:0 0 6px 0;font-size:18px}
  .kcal-tag{font-size:12px;color:#cbd5e1;background:#0f172a;border:1px solid #243044;padding:3px 8px;border-radius:999px}
  .opt-list{display:grid;gap:8px}
  .opt{display:flex;justify-content:space-between;align-items:center;gap:10px;
       border:1px solid #243044;background:#0c1624;border-radius:10px;padding:10px}
  .opt label{display:flex;align-items:center;gap:10px;cursor:pointer}
  .opt small{color:var(--muted)}
  .opt input[type="checkbox"]{accent-color:var(--accent);width:18px;height:18px}
  .note{font-size:12px;color:#9aa4b2;margin-top:6px}
  .foot{position:fixed;left:0;right:0;bottom:0;z-index:60;background:linear-gradient(180deg,rgba(17,24,39,.85),rgba(17,24,39,.98));
    border-top:1px solid #1f2937}
  .foot-inner{max-width:980px;margin:0 auto;padding:10px 14px;display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
  .total{font-weight:700}
  .btn{padding:8px 10px;border-radius:9px;border:1px solid #2a3648;background:#0b1522;color:#cbd5e1;font-size:13px;cursor:pointer}
  .btn.success{border-color:#22c55e}
  .btn.warn{border-color:#f59e0b;color:#fcd34d}
  .streak{display:flex;gap:10px;align-items:center}
  .pill{border:1px solid #2a3648;border-radius:999px;padding:4px 8px;font-size:12px;color:#cbd5e1;background:#0c1320}
</style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div>
        <h1>Plano Alimentar do Gustavo</h1>
        <div class="subtitle">Boxe: <b>seg/qua/sex de manh√£</b> ‚Ä¢ Academia: <b>todos os dias √†s 12h</b></div>
      </div>
      <span class="badge">Mobile-friendly</span>
    </div>
    <div class="row">
      <div class="switch"><input id="hasBoxe" type="checkbox"><label for="hasBoxe"><b>Hoje tem boxe de manh√£</b></label></div>
      <div class="chips" id="days">
        <button class="chip" data-day="seg">Seg</button>
        <button class="chip" data-day="ter">Ter</button>
        <button class="chip" data-day="qua">Qua</button>
        <button class="chip" data-day="qui">Qui</button>
        <button class="chip" data-day="sex">Sex</button>
        <button class="chip" data-day="sab">S√°b</button>
        <button class="chip" data-day="dom">Dom</button>
      </div>
    </div>
    <div class="note">Seg/Qua/Sex ligam o boxe automaticamente. <b>Sem boxe, o dia inicia com Caf√© da manh√£ (8h).</b></div>
  </div>
</header>

<main class="wrap" id="content"></main>

<footer class="foot">
  <div class="foot-inner">
    <div class="total">Consumido hoje: <span id="totalKcal">0</span> kcal</div>
    <div class="streak">
      <span class="pill">üî• Streak: <b id="streakNow">0</b> dias</span>
      <span class="pill">üèÜ Recorde: <b id="streakBest">0</b></span>
    </div>
    <div class="row">
      <button class="btn success" id="btnComplete">Concluir dia</button>
      <button class="btn warn" id="btnClearDay">Limpar marca√ß√µes do dia</button>
    </div>
  </div>
</footer>

<script>
/* ====== Sequ√™ncias de refei√ß√µes ====== */
const MEALS_BOXE = [
  {id:"antes-boxe",title:"Antes do Boxe (6h‚Äì6h30)",options:[
    {id:"banana_whey",label:"1 banana + whey + 5g creatina",kcal:210},
    {id:"pao_mel",label:"¬Ω p√£o + mel/geleia",kcal:150}
  ]},
  {id:"pos-boxe",title:"P√≥s-Boxe (~8h)",options:[
    {id:"pao_ovo_fruta",label:"P√£o + 2 ovos + 1 fruta",kcal:370},
    {id:"iogurte_aveia_banana",label:"Iogurte + aveia + banana",kcal:300}
  ]},
  {id:"lanche-manha",title:"Lanche da Manh√£ (10h30‚Äì11h)",options:[
    {id:"iog_aveia_pasta",label:"Iogurte + aveia + pasta de amendoim",kcal:290},
    {id:"fruta_castanhas",label:"1 fruta + 20g castanhas",kcal:220}
  ]},
  {id:"pre-academia",title:"Pr√©-Academia (11h30)",options:[
    {id:"banana",label:"1 banana",kcal:90},
    {id:"pao_mel_fatia",label:"1 fatia p√£o + mel/geleia",kcal:150}
  ]},
  {id:"pos-academia",title:"Almo√ßo (13h)",options:[
    {id:"arroz_feijao_frango",label:"Arroz (150g) + Feij√£o (100g) + Frango (150‚Äì200g)",kcal:570},
    {id:"arroz_carne_salada",label:"Arroz (150g) + Carne magra + salada/legumes",kcal:520}
  ]},
  {id:"lanche-tarde",title:"Lanche da Tarde (16h)",options:[
    {id:"whey_fruta",label:"Whey + 1 fruta",kcal:210},
    {id:"pao_ovo",label:"P√£o + ovo/queijo branco",kcal:250}
  ]},
  {id:"jantar",title:"Jantar (19h30‚Äì20h)",options:[
    {id:"macarrao_frango_legumes",label:"Macarr√£o (150g) + Frango (150g) + legumes/salada",kcal:530},
    {id:"arroz_feijao_peixe",label:"Arroz + Feij√£o + Peixe (150g) + salada",kcal:520}
  ]},
  {id:"ceia",title:"Ceia (22h, opcional)",options:[
    {id:"iog_aveia",label:"Iogurte + aveia",kcal:180},
    {id:"omelete_leve",label:"Omelete leve (2 ovos)",kcal:150}
  ]}
];

const MEALS_NO_BOXE = [
  {id:"cafe-manha",title:"Caf√© da manh√£ (8h)",options:[
    {id:"pao_ovos_fruta",label:"P√£o + 2 ovos mexidos + 1 fruta",kcal:370},
    {id:"iogurte_aveia_banana",label:"Iogurte + aveia + banana",kcal:300},
    {id:"banana_whey",label:"1 banana + 1 scoop whey + 5g creatina",kcal:210}
  ]},
  {id:"lanche-manha",title:"Lanche da Manh√£ (10h30‚Äì11h)",options:[
    {id:"fruta_castanhas",label:"1 fruta + 20g castanhas",kcal:220},
    {id:"pao_queijo",label:"1 fatia p√£o + queijo branco",kcal:200}
  ]},
  {id:"pre-academia",title:"Pr√©-Academia (11h30)",options:[
    {id:"banana",label:"1 banana",kcal:90},
    {id:"pao_mel_fatia",label:"1 fatia p√£o + mel/geleia",kcal:150}
  ]},
  {id:"pos-academia",title:"Almo√ßo (13h)",options:[
    {id:"arroz_feijao_frango",label:"Arroz (150g) + Feij√£o (100g) + Frango (150‚Äì200g)",kcal:570},
    {id:"arroz_carne_salada",label:"Arroz (150g) + Carne magra + salada/legumes",kcal:520}
  ]},
  {id:"lanche-tarde",title:"Lanche da Tarde (16h)",options:[
    {id:"whey_fruta",label:"Whey + 1 fruta",kcal:210},
    {id:"iogurte_cereal",label:"Iogurte + cereal simples",kcal:220}
  ]},
  {id:"jantar",title:"Jantar (19h30‚Äì20h)",options:[
    {id:"macarrao_frango_legumes",label:"Macarr√£o (150g) + Frango (150g) + legumes/salada",kcal:530},
    {id:"arroz_feijao_peixe",label:"Arroz + Feij√£o + Peixe (150g) + salada",kcal:520}
  ]},
  {id:"ceia",title:"Ceia (22h, opcional)",options:[
    {id:"iog_aveia",label:"Iogurte + aveia",kcal:180},
    {id:"omelete_leve",label:"Omelete leve (2 ovos)",kcal:150}
  ]}
];

/* ====== Estado, render e calorias ====== */
let state={hasBoxe:true,checked:{}};
const totalEl=document.getElementById("totalKcal"),
      content=document.getElementById("content"),
      days=document.getElementById("days"),
      hasBoxeToggle=document.getElementById("hasBoxe");

function keyOf(mealId,optId){ return `${mealId}__${optId}`; }

function render(){
  const MEALS = state.hasBoxe ? MEALS_BOXE : MEALS_NO_BOXE;
  content.innerHTML="";
  MEALS.forEach(m=>{
    const card=document.createElement("section");card.className="card meal";
    card.innerHTML=`<h2>${m.title}</h2><div class="opt-list"></div>
                    <div class="note">Marcadas nesta refei√ß√£o: <b class="kcal-tag">${sumMeal(m,MEALS)} kcal</b></div>`;
    const list=card.querySelector(".opt-list");
    m.options.forEach(o=>{
      const key = keyOf(m.id,o.id);
      const opt=document.createElement("div");opt.className="opt";
      opt.innerHTML=`<label><input type="checkbox"> ${o.label} <small>${o.kcal} kcal</small></label>`;
      const input=opt.querySelector("input");input.checked=!!state.checked[key];
      input.addEventListener("change",()=>{
        if(input.checked) state.checked[key]=o.kcal; else delete state.checked[key];
        card.querySelector(".kcal-tag").textContent = sumMeal(m,MEALS) + " kcal";
        updateTotal(MEALS);
        saveDayMarks(); // salva marca√ß√µes do dia
      });
      list.appendChild(opt);
    });
    content.appendChild(card);
  });
  updateTotal(MEALS);
}

function sumMeal(meal, MEALS){
  let s=0;
  for(const o of meal.options){
    if(state.checked[keyOf(meal.id,o.id)]) s += o.kcal;
  }
  return s;
}
function totalKcal(MEALS){
  let t=0;
  for(const m of MEALS){
    for(const o of m.options){
      if(state.checked[keyOf(m.id,o.id)]) t += o.kcal;
    }
  }
  return t;
}
function updateTotal(MEALS){ totalEl.textContent = totalKcal(MEALS); }

/* ====== Controle de dia/boxe ====== */
hasBoxeToggle.addEventListener("change",e=>{
  state.hasBoxe=e.target.checked; render();
});
days.addEventListener("click",e=>{
  const c=e.target.closest(".chip"); if(!c) return;
  days.querySelectorAll(".chip").forEach(x=>x.classList.remove("active"));
  c.classList.add("active");
  state.hasBoxe = ["seg","qua","sex"].includes(c.dataset.day);
  hasBoxeToggle.checked = state.hasBoxe;
  render();
});

/* ====== Streak (sequ√™ncia) ====== */
const STREAK_KEY="plano_streak_v1";
const streakNowEl=document.getElementById("streakNow");
const streakBestEl=document.getElementById("streakBest");
const btnComplete=document.getElementById("btnComplete");
const btnClearDay=document.getElementById("btnClearDay");

/* util datas (usa fuso local do aparelho) */
function todayISO(){ const d=new Date(); d.setHours(0,0,0,0); return d.toISOString().slice(0,10); }
function yesterdayISO(){ const d=new Date(); d.setHours(0,0,0,0); d.setDate(d.getDate()-1); return d.toISOString().slice(0,10); }

function loadStreak(){
  try{
    const raw=localStorage.getItem(STREAK_KEY);
    if(raw) return JSON.parse(raw);
  }catch(e){}
  return {current:0,best:0,completed:{},lastOpen:todayISO()};
}
function saveStreak(){ localStorage.setItem(STREAK_KEY, JSON.stringify(streak)); }

let streak = loadStreak();

/* Reseta sequ√™ncia se ontem n√£o foi conclu√≠do e j√° ‚Äúvirou o dia‚Äù */
function reconcileStreakOnOpen(){
  const t=todayISO(), y=yesterdayISO();
  // se j√° passou para um novo dia e ontem n√£o est√° conclu√≠do, zera
  if(streak.lastOpen !== t){
    if(!streak.completed[y]){ streak.current = 0; }
    streak.lastOpen = t;
    saveStreak();
  }
  updateStreakUI();
}

/* Concluir dia (marca hoje e atualiza sequ√™ncia) */
btnComplete.addEventListener("click", ()=>{
  const t=todayISO(), y=yesterdayISO();
  if(streak.completed[t]){ alert("Hoje j√° est√° conclu√≠do ‚úÖ"); return; }
  // regra simples: se ontem foi conclu√≠do, incrementa; sen√£o recome√ßa do 1
  streak.current = streak.completed[y] ? (streak.current+1) : 1;
  if(streak.current > streak.best) streak.best = streak.current;
  streak.completed[t] = true;
  streak.lastOpen = t;
  saveStreak();
  updateStreakUI();
  alert("Dia conclu√≠do! üî• Streak atual: " + streak.current);
});

/* UI streak */
function updateStreakUI(){
  streakNowEl.textContent = streak.current || 0;
  streakBestEl.textContent = streak.best || 0;
}

/* ====== Persist√™ncia das marca√ß√µes do dia ====== */
const MARKS_KEY_PREFIX = "plano_marks_"; // por data
function marksKeyForToday(){ return MARKS_KEY_PREFIX + todayISO(); }
function saveDayMarks(){
  try{ localStorage.setItem(marksKeyForToday(), JSON.stringify(state.checked)); }catch(e){}
}
function loadDayMarks(){
  try{
    const raw = localStorage.getItem(marksKeyForToday());
    if(raw) state.checked = JSON.parse(raw) || {};
    else state.checked = {};
  }catch(e){ state.checked = {}; }
}

/* Limpar marca√ß√µes do dia (n√£o mexe na sequ√™ncia) */
btnClearDay.addEventListener("click", ()=>{
  state.checked = {};
  localStorage.removeItem(marksKeyForToday());
  render();
});

/* ====== Init ====== */
(function init(){
  // UI: marcar segunda como ativo por padr√£o
  Array.from(days.children)[0].classList.add("active"); // seg
  hasBoxeToggle.checked = state.hasBoxe;

  // streak: checagem de ‚Äúvirada de dia‚Äù e reset se precisou
  reconcileStreakOnOpen();

  // carrega marca√ß√µes do dia (por data)
  loadDayMarks();

  // render inicial
  render();
})();
</script>
</body>
</html>
